// Copyright 2018-2023 the Deno authors. All rights reserved. MIT license.
// This module is browser compatible.
// deno-lint-ignore-file ban-types
import { filterInPlace } from "./_utils.ts";
const { hasOwn  } = Object;
export function deepMerge(record, other, options) {
    return deepMergeInternal(record, other, new Set(), options);
}
function deepMergeInternal(record, other, seen, options) {
    const result = {};
    const keys = new Set([
        ...getKeys(record),
        ...getKeys(other), 
    ]);
    // Iterate through each key of other object and use correct merging strategy
    for (const key of keys){
        // Skip to prevent Object.prototype.__proto__ accessor property calls on non-Deno platforms
        if (key === "__proto__") {
            continue;
        }
        const a = record[key];
        if (!hasOwn(other, key)) {
            result[key] = a;
            continue;
        }
        const b = other[key];
        if (isNonNullObject(a) && isNonNullObject(b) && !seen.has(a) && !seen.has(b)) {
            seen.add(a);
            seen.add(b);
            result[key] = mergeObjects(a, b, seen, options);
            continue;
        }
        // Override value
        result[key] = b;
    }
    return result;
}
function mergeObjects(left, right, seen, options = {
    arrays: "merge",
    sets: "merge",
    maps: "merge"
}) {
    // Recursively merge mergeable objects
    if (isMergeable(left) && isMergeable(right)) {
        return deepMergeInternal(left, right, seen, options);
    }
    if (isIterable(left) && isIterable(right)) {
        // Handle arrays
        if (Array.isArray(left) && Array.isArray(right)) {
            if (options.arrays === "merge") {
                return left.concat(right);
            }
            return right;
        }
        // Handle maps
        if (left instanceof Map && right instanceof Map) {
            if (options.maps === "merge") {
                return new Map([
                    ...left,
                    ...right, 
                ]);
            }
            return right;
        }
        // Handle sets
        if (left instanceof Set && right instanceof Set) {
            if (options.sets === "merge") {
                return new Set([
                    ...left,
                    ...right, 
                ]);
            }
            return right;
        }
    }
    return right;
}
/**
 * Test whether a value is mergeable or not
 * Builtins that look like objects, null and user defined classes
 * are not considered mergeable (it means that reference will be copied)
 */ function isMergeable(value) {
    return Object.getPrototypeOf(value) === Object.prototype;
}
function isIterable(value) {
    return typeof value[Symbol.iterator] === "function";
}
function isNonNullObject(value) {
    return value !== null && typeof value === "object";
}
function getKeys(record) {
    const ret = Object.getOwnPropertySymbols(record);
    filterInPlace(ret, (key)=>Object.prototype.propertyIsEnumerable.call(record, key));
    ret.push(...Object.keys(record));
    return ret;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3N0ZEAwLjE4MS4wL2NvbGxlY3Rpb25zL2RlZXBfbWVyZ2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29weXJpZ2h0IDIwMTgtMjAyMyB0aGUgRGVubyBhdXRob3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLiBNSVQgbGljZW5zZS5cbi8vIFRoaXMgbW9kdWxlIGlzIGJyb3dzZXIgY29tcGF0aWJsZS5cblxuLy8gZGVuby1saW50LWlnbm9yZS1maWxlIGJhbi10eXBlc1xuXG5pbXBvcnQgeyBmaWx0ZXJJblBsYWNlIH0gZnJvbSBcIi4vX3V0aWxzLnRzXCI7XG5cbmNvbnN0IHsgaGFzT3duIH0gPSBPYmplY3Q7XG5cbi8qKlxuICogTWVyZ2VzIHRoZSB0d28gZ2l2ZW4gUmVjb3JkcywgcmVjdXJzaXZlbHkgbWVyZ2luZyBhbnkgbmVzdGVkIFJlY29yZHMgd2l0aCB0aGVcbiAqIHNlY29uZCBjb2xsZWN0aW9uIG92ZXJyaWRpbmcgdGhlIGZpcnN0IGluIGNhc2Ugb2YgY29uZmxpY3RcbiAqXG4gKiBGb3IgYXJyYXlzLCBtYXBzIGFuZCBzZXRzLCBhIG1lcmdpbmcgc3RyYXRlZ3kgY2FuIGJlIHNwZWNpZmllZCB0byBlaXRoZXJcbiAqIGByZXBsYWNlYCB2YWx1ZXMsIG9yIGBtZXJnZWAgdGhlbSBpbnN0ZWFkLiBVc2UgYGluY2x1ZGVOb25FbnVtZXJhYmxlYCBvcHRpb25cbiAqIHRvIGluY2x1ZGUgbm9uLWVudW1lcmFibGUgcHJvcGVydGllcyB0b28uXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYHRzXG4gKiBpbXBvcnQgeyBkZWVwTWVyZ2UgfSBmcm9tIFwiaHR0cHM6Ly9kZW5vLmxhbmQvc3RkQCRTVERfVkVSU0lPTi9jb2xsZWN0aW9ucy9kZWVwX21lcmdlLnRzXCI7XG4gKiBpbXBvcnQgeyBhc3NlcnRFcXVhbHMgfSBmcm9tIFwiaHR0cHM6Ly9kZW5vLmxhbmQvc3RkQCRTVERfVkVSU0lPTi90ZXN0aW5nL2Fzc2VydHMudHNcIjtcbiAqXG4gKiBjb25zdCBhID0geyBmb286IHRydWUgfTtcbiAqIGNvbnN0IGIgPSB7IGZvbzogeyBiYXI6IHRydWUgfSB9O1xuICpcbiAqIGFzc2VydEVxdWFscyhkZWVwTWVyZ2UoYSwgYiksIHsgZm9vOiB7IGJhcjogdHJ1ZSB9IH0pO1xuICogYGBgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkZWVwTWVyZ2U8XG4gIFQgZXh0ZW5kcyBSZWNvcmQ8UHJvcGVydHlLZXksIHVua25vd24+LFxuPihcbiAgcmVjb3JkOiBQYXJ0aWFsPFJlYWRvbmx5PFQ+PixcbiAgb3RoZXI6IFBhcnRpYWw8UmVhZG9ubHk8VD4+LFxuICBvcHRpb25zPzogUmVhZG9ubHk8RGVlcE1lcmdlT3B0aW9ucz4sXG4pOiBUO1xuXG5leHBvcnQgZnVuY3Rpb24gZGVlcE1lcmdlPFxuICBUIGV4dGVuZHMgUmVjb3JkPFByb3BlcnR5S2V5LCB1bmtub3duPixcbiAgVSBleHRlbmRzIFJlY29yZDxQcm9wZXJ0eUtleSwgdW5rbm93bj4sXG4gIE9wdGlvbnMgZXh0ZW5kcyBEZWVwTWVyZ2VPcHRpb25zLFxuPihcbiAgcmVjb3JkOiBSZWFkb25seTxUPixcbiAgb3RoZXI6IFJlYWRvbmx5PFU+LFxuICBvcHRpb25zPzogUmVhZG9ubHk8T3B0aW9ucz4sXG4pOiBEZWVwTWVyZ2U8VCwgVSwgT3B0aW9ucz47XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWVwTWVyZ2U8XG4gIFQgZXh0ZW5kcyBSZWNvcmQ8UHJvcGVydHlLZXksIHVua25vd24+LFxuICBVIGV4dGVuZHMgUmVjb3JkPFByb3BlcnR5S2V5LCB1bmtub3duPixcbiAgT3B0aW9ucyBleHRlbmRzIERlZXBNZXJnZU9wdGlvbnMgPSB7XG4gICAgYXJyYXlzOiBcIm1lcmdlXCI7XG4gICAgc2V0czogXCJtZXJnZVwiO1xuICAgIG1hcHM6IFwibWVyZ2VcIjtcbiAgfSxcbj4oXG4gIHJlY29yZDogUmVhZG9ubHk8VD4sXG4gIG90aGVyOiBSZWFkb25seTxVPixcbiAgb3B0aW9ucz86IFJlYWRvbmx5PE9wdGlvbnM+LFxuKTogRGVlcE1lcmdlPFQsIFUsIE9wdGlvbnM+IHtcbiAgcmV0dXJuIGRlZXBNZXJnZUludGVybmFsKHJlY29yZCwgb3RoZXIsIG5ldyBTZXQoKSwgb3B0aW9ucyk7XG59XG5cbmZ1bmN0aW9uIGRlZXBNZXJnZUludGVybmFsPFxuICBUIGV4dGVuZHMgUmVjb3JkPFByb3BlcnR5S2V5LCB1bmtub3duPixcbiAgVSBleHRlbmRzIFJlY29yZDxQcm9wZXJ0eUtleSwgdW5rbm93bj4sXG4gIE9wdGlvbnMgZXh0ZW5kcyBEZWVwTWVyZ2VPcHRpb25zID0ge1xuICAgIGFycmF5czogXCJtZXJnZVwiO1xuICAgIHNldHM6IFwibWVyZ2VcIjtcbiAgICBtYXBzOiBcIm1lcmdlXCI7XG4gIH0sXG4+KFxuICByZWNvcmQ6IFJlYWRvbmx5PFQ+LFxuICBvdGhlcjogUmVhZG9ubHk8VT4sXG4gIHNlZW46IFNldDxOb25OdWxsYWJsZTxvYmplY3Q+PixcbiAgb3B0aW9ucz86IFJlYWRvbmx5PE9wdGlvbnM+LFxuKSB7XG4gIC8vIEV4dHJhY3Qgb3B0aW9uc1xuICAvLyBDbG9uZSBsZWZ0IG9wZXJhbmQgdG8gYXZvaWQgcGVyZm9ybWluZyBtdXRhdGlvbnMgaW4tcGxhY2VcbiAgdHlwZSBSZXN1bHQgPSBEZWVwTWVyZ2U8VCwgVSwgT3B0aW9ucz47XG4gIGNvbnN0IHJlc3VsdDogUGFydGlhbDxSZXN1bHQ+ID0ge307XG5cbiAgY29uc3Qga2V5cyA9IG5ldyBTZXQoW1xuICAgIC4uLmdldEtleXMocmVjb3JkKSxcbiAgICAuLi5nZXRLZXlzKG90aGVyKSxcbiAgXSkgYXMgU2V0PGtleW9mIFJlc3VsdD47XG5cbiAgLy8gSXRlcmF0ZSB0aHJvdWdoIGVhY2gga2V5IG9mIG90aGVyIG9iamVjdCBhbmQgdXNlIGNvcnJlY3QgbWVyZ2luZyBzdHJhdGVneVxuICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzKSB7XG4gICAgLy8gU2tpcCB0byBwcmV2ZW50IE9iamVjdC5wcm90b3R5cGUuX19wcm90b19fIGFjY2Vzc29yIHByb3BlcnR5IGNhbGxzIG9uIG5vbi1EZW5vIHBsYXRmb3Jtc1xuICAgIGlmIChrZXkgPT09IFwiX19wcm90b19fXCIpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIHR5cGUgUmVzdWx0TWVtYmVyID0gUmVzdWx0W3R5cGVvZiBrZXldO1xuXG4gICAgY29uc3QgYSA9IHJlY29yZFtrZXldIGFzIFJlc3VsdE1lbWJlcjtcblxuICAgIGlmICghaGFzT3duKG90aGVyLCBrZXkpKSB7XG4gICAgICByZXN1bHRba2V5XSA9IGE7XG5cbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGNvbnN0IGIgPSBvdGhlcltrZXldIGFzIFJlc3VsdE1lbWJlcjtcblxuICAgIGlmIChcbiAgICAgIGlzTm9uTnVsbE9iamVjdChhKSAmJiBpc05vbk51bGxPYmplY3QoYikgJiYgIXNlZW4uaGFzKGEpICYmICFzZWVuLmhhcyhiKVxuICAgICkge1xuICAgICAgc2Vlbi5hZGQoYSk7XG4gICAgICBzZWVuLmFkZChiKTtcbiAgICAgIHJlc3VsdFtrZXldID0gbWVyZ2VPYmplY3RzKGEsIGIsIHNlZW4sIG9wdGlvbnMpIGFzIFJlc3VsdE1lbWJlcjtcblxuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgLy8gT3ZlcnJpZGUgdmFsdWVcbiAgICByZXN1bHRba2V5XSA9IGI7XG4gIH1cblxuICByZXR1cm4gcmVzdWx0IGFzIFJlc3VsdDtcbn1cblxuZnVuY3Rpb24gbWVyZ2VPYmplY3RzKFxuICBsZWZ0OiBSZWFkb25seTxOb25OdWxsYWJsZTxvYmplY3Q+PixcbiAgcmlnaHQ6IFJlYWRvbmx5PE5vbk51bGxhYmxlPG9iamVjdD4+LFxuICBzZWVuOiBTZXQ8Tm9uTnVsbGFibGU8b2JqZWN0Pj4sXG4gIG9wdGlvbnM6IFJlYWRvbmx5PERlZXBNZXJnZU9wdGlvbnM+ID0ge1xuICAgIGFycmF5czogXCJtZXJnZVwiLFxuICAgIHNldHM6IFwibWVyZ2VcIixcbiAgICBtYXBzOiBcIm1lcmdlXCIsXG4gIH0sXG4pOiBSZWFkb25seTxOb25OdWxsYWJsZTxvYmplY3Q+PiB7XG4gIC8vIFJlY3Vyc2l2ZWx5IG1lcmdlIG1lcmdlYWJsZSBvYmplY3RzXG4gIGlmIChpc01lcmdlYWJsZShsZWZ0KSAmJiBpc01lcmdlYWJsZShyaWdodCkpIHtcbiAgICByZXR1cm4gZGVlcE1lcmdlSW50ZXJuYWwobGVmdCwgcmlnaHQsIHNlZW4sIG9wdGlvbnMpO1xuICB9XG5cbiAgaWYgKGlzSXRlcmFibGUobGVmdCkgJiYgaXNJdGVyYWJsZShyaWdodCkpIHtcbiAgICAvLyBIYW5kbGUgYXJyYXlzXG4gICAgaWYgKChBcnJheS5pc0FycmF5KGxlZnQpKSAmJiAoQXJyYXkuaXNBcnJheShyaWdodCkpKSB7XG4gICAgICBpZiAob3B0aW9ucy5hcnJheXMgPT09IFwibWVyZ2VcIikge1xuICAgICAgICByZXR1cm4gbGVmdC5jb25jYXQocmlnaHQpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmlnaHQ7XG4gICAgfVxuXG4gICAgLy8gSGFuZGxlIG1hcHNcbiAgICBpZiAoKGxlZnQgaW5zdGFuY2VvZiBNYXApICYmIChyaWdodCBpbnN0YW5jZW9mIE1hcCkpIHtcbiAgICAgIGlmIChvcHRpb25zLm1hcHMgPT09IFwibWVyZ2VcIikge1xuICAgICAgICByZXR1cm4gbmV3IE1hcChbXG4gICAgICAgICAgLi4ubGVmdCxcbiAgICAgICAgICAuLi5yaWdodCxcbiAgICAgICAgXSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByaWdodDtcbiAgICB9XG5cbiAgICAvLyBIYW5kbGUgc2V0c1xuICAgIGlmICgobGVmdCBpbnN0YW5jZW9mIFNldCkgJiYgKHJpZ2h0IGluc3RhbmNlb2YgU2V0KSkge1xuICAgICAgaWYgKG9wdGlvbnMuc2V0cyA9PT0gXCJtZXJnZVwiKSB7XG4gICAgICAgIHJldHVybiBuZXcgU2V0KFtcbiAgICAgICAgICAuLi5sZWZ0LFxuICAgICAgICAgIC4uLnJpZ2h0LFxuICAgICAgICBdKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJpZ2h0O1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiByaWdodDtcbn1cblxuLyoqXG4gKiBUZXN0IHdoZXRoZXIgYSB2YWx1ZSBpcyBtZXJnZWFibGUgb3Igbm90XG4gKiBCdWlsdGlucyB0aGF0IGxvb2sgbGlrZSBvYmplY3RzLCBudWxsIGFuZCB1c2VyIGRlZmluZWQgY2xhc3Nlc1xuICogYXJlIG5vdCBjb25zaWRlcmVkIG1lcmdlYWJsZSAoaXQgbWVhbnMgdGhhdCByZWZlcmVuY2Ugd2lsbCBiZSBjb3BpZWQpXG4gKi9cbmZ1bmN0aW9uIGlzTWVyZ2VhYmxlKFxuICB2YWx1ZTogTm9uTnVsbGFibGU8b2JqZWN0Pixcbik6IHZhbHVlIGlzIFJlY29yZDxQcm9wZXJ0eUtleSwgdW5rbm93bj4ge1xuICByZXR1cm4gT2JqZWN0LmdldFByb3RvdHlwZU9mKHZhbHVlKSA9PT0gT2JqZWN0LnByb3RvdHlwZTtcbn1cblxuZnVuY3Rpb24gaXNJdGVyYWJsZShcbiAgdmFsdWU6IE5vbk51bGxhYmxlPG9iamVjdD4sXG4pOiB2YWx1ZSBpcyBJdGVyYWJsZTx1bmtub3duPiB7XG4gIHJldHVybiB0eXBlb2YgKHZhbHVlIGFzIEl0ZXJhYmxlPHVua25vd24+KVtTeW1ib2wuaXRlcmF0b3JdID09PSBcImZ1bmN0aW9uXCI7XG59XG5cbmZ1bmN0aW9uIGlzTm9uTnVsbE9iamVjdCh2YWx1ZTogdW5rbm93bik6IHZhbHVlIGlzIE5vbk51bGxhYmxlPG9iamVjdD4ge1xuICByZXR1cm4gdmFsdWUgIT09IG51bGwgJiYgdHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiO1xufVxuXG5mdW5jdGlvbiBnZXRLZXlzPFQgZXh0ZW5kcyBvYmplY3Q+KHJlY29yZDogVCk6IEFycmF5PGtleW9mIFQ+IHtcbiAgY29uc3QgcmV0ID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhyZWNvcmQpIGFzIEFycmF5PGtleW9mIFQ+O1xuICBmaWx0ZXJJblBsYWNlKFxuICAgIHJldCxcbiAgICAoa2V5KSA9PiBPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwocmVjb3JkLCBrZXkpLFxuICApO1xuICByZXQucHVzaCguLi4oT2JqZWN0LmtleXMocmVjb3JkKSBhcyBBcnJheTxrZXlvZiBUPikpO1xuXG4gIHJldHVybiByZXQ7XG59XG5cbi8qKiBNZXJnaW5nIHN0cmF0ZWd5ICovXG5leHBvcnQgdHlwZSBNZXJnaW5nU3RyYXRlZ3kgPSBcInJlcGxhY2VcIiB8IFwibWVyZ2VcIjtcblxuLyoqIERlZXAgbWVyZ2Ugb3B0aW9ucyAqL1xuZXhwb3J0IHR5cGUgRGVlcE1lcmdlT3B0aW9ucyA9IHtcbiAgLyoqIE1lcmdpbmcgc3RyYXRlZ3kgZm9yIGFycmF5cyAqL1xuICBhcnJheXM/OiBNZXJnaW5nU3RyYXRlZ3k7XG4gIC8qKiBNZXJnaW5nIHN0cmF0ZWd5IGZvciBNYXBzICovXG4gIG1hcHM/OiBNZXJnaW5nU3RyYXRlZ3k7XG4gIC8qKiBNZXJnaW5nIHN0cmF0ZWd5IGZvciBTZXRzICovXG4gIHNldHM/OiBNZXJnaW5nU3RyYXRlZ3k7XG59O1xuXG4vKipcbiAqIEhvdyBkb2VzIHJlY3Vyc2l2ZSB0eXBpbmcgd29ya3MgP1xuICpcbiAqIERlZXAgbWVyZ2luZyBwcm9jZXNzIGlzIGhhbmRsZWQgdGhyb3VnaCBgRGVlcE1lcmdlPFQsIFUsIE9wdGlvbnM+YCB0eXBlLlxuICogSWYgYm90aCBUIGFuZCBVIGFyZSBSZWNvcmRzLCB3ZSByZWN1cnNpdmVseSBtZXJnZSB0aGVtLFxuICogZWxzZSB3ZSB0cmVhdCB0aGVtIGFzIHByaW1pdGl2ZXMuXG4gKlxuICogTWVyZ2luZyBwcm9jZXNzIGlzIGhhbmRsZWQgdGhyb3VnaCBgTWVyZ2U8VCwgVT5gIHR5cGUsIGluIHdoaWNoXG4gKiB3ZSByZW1vdmUgYWxsIG1hcHMsIHNldHMsIGFycmF5cyBhbmQgcmVjb3JkcyBzbyB3ZSBjYW4gaGFuZGxlIHRoZW1cbiAqIHNlcGFyYXRlbHkgZGVwZW5kaW5nIG9uIG1lcmdpbmcgc3RyYXRlZ3k6XG4gKlxuICogICAgTWVyZ2U8XG4gKiAgICAgIHtmb286IHN0cmluZ30sXG4gKiAgICAgIHtiYXI6IHN0cmluZywgYmF6OiBTZXQ8dW5rbm93bj59LFxuICogICAgPiAvLyBcImZvb1wiIGFuZCBcImJhclwiIHdpbGwgYmUgaGFuZGxlZCB3aXRoIGBNZXJnZVJpZ2h0T21pdENvbXBsZXhlc2BcbiAqICAgICAgLy8gXCJiYXpcIiB3aWxsIGJlIGhhbmRsZWQgd2l0aCBgTWVyZ2VBbGwqYCB0eXBlXG4gKlxuICogYE1lcmdlUmlnaHRPbWl0Q29tcGxleGVzPFQsIFU+YCB3aWxsIGRvIHRoZSBhYm92ZTogYWxsIFQnc1xuICogZXhjbHVzaXZlIGtleXMgd2lsbCBiZSBrZXB0LCB0aG91Z2ggY29tbW9uIG9uZXMgd2l0aCBVIHdpbGwgaGF2ZSB0aGVpclxuICogdHlwaW5nIG92ZXJyaWRkZW4gaW5zdGVhZDpcbiAqXG4gKiAgICBNZXJnZVJpZ2h0T21pdENvbXBsZXhlczxcbiAqICAgICAge2Zvbzogc3RyaW5nLCBiYXo6IG51bWJlcn0sXG4gKiAgICAgIHtmb286IGJvb2xlYW4sIGJhcjogc3RyaW5nfVxuICogICAgPiAvLyB7YmF6OiBudW1iZXIsIGZvbzogYm9vbGVhbiwgYmFyOiBzdHJpbmd9XG4gKiAgICAgIC8vIFwiYmF6XCIgd2FzIGtlcHQgZnJvbSBUXG4gKiAgICAgIC8vIFwiZm9vXCIgd2FzIG92ZXJyaWRkZW4gYnkgVSdzIHR5cGluZ1xuICogICAgICAvLyBcImJhclwiIHdhcyBhZGRlZCBmcm9tIFVcbiAqXG4gKiBGb3IgTWFwcywgQXJyYXlzLCBTZXRzIGFuZCBSZWNvcmRzLCB3ZSB1c2UgYE1lcmdlQWxsKjxULCBVPmAgdXRpbGl0eVxuICogdHlwZXMuIFRoZXkgd2lsbCBleHRyYWN0IHJlbGV2YW50IGRhdGEgc3RydWN0dXJlIGZyb20gYm90aCBUIGFuZCBVXG4gKiAocHJvdmlkaW5nIHRoYXQgYm90aCBoYXZlIHNhbWUgZGF0YSBkYXRhIHN0cnVjdHVyZSwgZXhjZXB0IGZvciB0eXBpbmcpLlxuICpcbiAqIEZyb20gdGhlc2UsIGAqVmFsdWVUeXBlPFQ+YCB3aWxsIGV4dHJhY3QgdmFsdWVzIChhbmQga2V5cykgdHlwZXMgdG8gYmVcbiAqIGFibGUgdG8gY3JlYXRlIGEgbmV3IGRhdGEgc3RydWN0dXJlIHdpdGggYW4gdW5pb24gdHlwaW5nIGZyb20gYm90aFxuICogZGF0YSBzdHJ1Y3R1cmUgb2YgVCBhbmQgVTpcbiAqXG4gKiAgICBNZXJnZUFsbFNldHM8XG4gKiAgICAgIHtmb286IFNldDxudW1iZXI+fSxcbiAqICAgICAge2ZvbzogU2V0PHN0cmluZz59XG4gKiAgICA+IC8vIGBTZXRWYWx1ZVR5cGVgIHdpbGwgZXh0cmFjdCBcIm51bWJlclwiIGZvciBUXG4gKiAgICAgIC8vIGBTZXRWYWx1ZVR5cGVgIHdpbGwgZXh0cmFjdCBcInN0cmluZ1wiIGZvciBVXG4gKiAgICAgIC8vIGBNZXJnZUFsbFNldHNgIHdpbGwgaW5mZXIgdHlwZSBhcyBTZXQ8bnVtYmVyfHN0cmluZz5cbiAqICAgICAgLy8gUHJvY2VzcyBpcyBzaW1pbGFyIGZvciBNYXBzLCBBcnJheXMsIGFuZCBTZXRzXG4gKlxuICogYERlZXBNZXJnZTxULCBVLCBPcHRpb25zPmAgaXMgdGFraW5nIGEgdGhpcmQgYXJndW1lbnQgdG8gYmUgaGFuZGxlIHRvXG4gKiBpbmZlciBmaW5hbCB0eXBpbmcgZGVwZW5kaW5nIG9uIG1lcmdpbmcgc3RyYXRlZ3k6XG4gKlxuICogICAgJiAoT3B0aW9ucyBleHRlbmRzIHsgc2V0czogXCJyZXBsYWNlXCIgfSA/IFBhcnRpYWxCeVR5cGU8VSwgU2V0PHVua25vd24+PlxuICogICAgICA6IE1lcmdlQWxsU2V0czxULCBVPilcbiAqXG4gKiBJbiB0aGUgYWJvdmUgbGluZSwgaWYgXCJPcHRpb25zXCIgaGF2ZSBpdHMgbWVyZ2luZyBzdHJhdGVneSBmb3IgU2V0cyBzZXQgdG9cbiAqIFwicmVwbGFjZVwiLCBpbnN0ZWFkIG9mIHBlcmZvcm1pbmcgbWVyZ2luZyBvZiBTZXRzIHR5cGUsIGl0IHdpbGwgdGFrZSB0aGVcbiAqIHR5cGluZyBmcm9tIHJpZ2h0IG9wZXJhbmQgKFUpIGluc3RlYWQsIGVmZmVjdGl2ZWx5IHJlcGxhY2luZyB0aGUgdHlwaW5nLlxuICpcbiAqIEFuIGFkZGl0aW9uYWwgbm90ZSwgd2UgdXNlIGBFeHBhbmRSZWN1cnNpdmVseTxUPmAgdXRpbGl0eSB0eXBlIHRvIGV4cGFuZFxuICogdGhlIHJlc3VsdGluZyB0eXBpbmcgYW5kIGhpZGUgYWxsIHRoZSB0eXBpbmcgbG9naWMgb2YgZGVlcCBtZXJnaW5nIHNvIGl0IGlzXG4gKiBtb3JlIHVzZXIgZnJpZW5kbHkuXG4gKi9cblxuLyoqIEZvcmNlIGludGVsbGlzZW5zZSB0byBleHBhbmQgdGhlIHR5cGluZyB0byBoaWRlIG1lcmdpbmcgdHlwaW5ncyAqL1xudHlwZSBFeHBhbmRSZWN1cnNpdmVseTxUPiA9IFQgZXh0ZW5kcyBSZWNvcmQ8UHJvcGVydHlLZXksIHVua25vd24+XG4gID8gVCBleHRlbmRzIGluZmVyIE8gPyB7IFtLIGluIGtleW9mIE9dOiBFeHBhbmRSZWN1cnNpdmVseTxPW0tdPiB9IDogbmV2ZXJcbiAgOiBUO1xuXG4vKiogRmlsdGVyIG9mIGtleXMgbWF0Y2hpbmcgYSBnaXZlbiB0eXBlICovXG50eXBlIFBhcnRpYWxCeVR5cGU8VCwgVT4gPSB7XG4gIFtLIGluIGtleW9mIFQgYXMgVFtLXSBleHRlbmRzIFUgPyBLIDogbmV2ZXJdOiBUW0tdO1xufTtcblxuLyoqIEdldCBzZXQgdmFsdWVzIHR5cGUgKi9cbnR5cGUgU2V0VmFsdWVUeXBlPFQ+ID0gVCBleHRlbmRzIFNldDxpbmZlciBWPiA/IFYgOiBuZXZlcjtcblxuLyoqIE1lcmdlIGFsbCBzZXRzIHR5cGVzIGRlZmluaXRpb25zIGZyb20ga2V5cyBwcmVzZW50IGluIGJvdGggb2JqZWN0cyAqL1xudHlwZSBNZXJnZUFsbFNldHM8XG4gIFQsXG4gIFUsXG4gIFggPSBQYXJ0aWFsQnlUeXBlPFQsIFNldDx1bmtub3duPj4sXG4gIFkgPSBQYXJ0aWFsQnlUeXBlPFUsIFNldDx1bmtub3duPj4sXG4gIFogPSB7XG4gICAgW0sgaW4ga2V5b2YgWCAmIGtleW9mIFldOiBTZXQ8U2V0VmFsdWVUeXBlPFhbS10+IHwgU2V0VmFsdWVUeXBlPFlbS10+PjtcbiAgfSxcbj4gPSBaO1xuXG4vKiogR2V0IGFycmF5IHZhbHVlcyB0eXBlICovXG50eXBlIEFycmF5VmFsdWVUeXBlPFQ+ID0gVCBleHRlbmRzIEFycmF5PGluZmVyIFY+ID8gViA6IG5ldmVyO1xuXG4vKiogTWVyZ2UgYWxsIHNldHMgdHlwZXMgZGVmaW5pdGlvbnMgZnJvbSBrZXlzIHByZXNlbnQgaW4gYm90aCBvYmplY3RzICovXG50eXBlIE1lcmdlQWxsQXJyYXlzPFxuICBULFxuICBVLFxuICBYID0gUGFydGlhbEJ5VHlwZTxULCBBcnJheTx1bmtub3duPj4sXG4gIFkgPSBQYXJ0aWFsQnlUeXBlPFUsIEFycmF5PHVua25vd24+PixcbiAgWiA9IHtcbiAgICBbSyBpbiBrZXlvZiBYICYga2V5b2YgWV06IEFycmF5PFxuICAgICAgQXJyYXlWYWx1ZVR5cGU8WFtLXT4gfCBBcnJheVZhbHVlVHlwZTxZW0tdPlxuICAgID47XG4gIH0sXG4+ID0gWjtcblxuLyoqIEdldCBtYXAgdmFsdWVzIHR5cGVzICovXG50eXBlIE1hcEtleVR5cGU8VD4gPSBUIGV4dGVuZHMgTWFwPGluZmVyIEssIHVua25vd24+ID8gSyA6IG5ldmVyO1xuXG4vKiogR2V0IG1hcCB2YWx1ZXMgdHlwZXMgKi9cbnR5cGUgTWFwVmFsdWVUeXBlPFQ+ID0gVCBleHRlbmRzIE1hcDx1bmtub3duLCBpbmZlciBWPiA/IFYgOiBuZXZlcjtcblxuLyoqIE1lcmdlIGFsbCBzZXRzIHR5cGVzIGRlZmluaXRpb25zIGZyb20ga2V5cyBwcmVzZW50IGluIGJvdGggb2JqZWN0cyAqL1xudHlwZSBNZXJnZUFsbE1hcHM8XG4gIFQsXG4gIFUsXG4gIFggPSBQYXJ0aWFsQnlUeXBlPFQsIE1hcDx1bmtub3duLCB1bmtub3duPj4sXG4gIFkgPSBQYXJ0aWFsQnlUeXBlPFUsIE1hcDx1bmtub3duLCB1bmtub3duPj4sXG4gIFogPSB7XG4gICAgW0sgaW4ga2V5b2YgWCAmIGtleW9mIFldOiBNYXA8XG4gICAgICBNYXBLZXlUeXBlPFhbS10+IHwgTWFwS2V5VHlwZTxZW0tdPixcbiAgICAgIE1hcFZhbHVlVHlwZTxYW0tdPiB8IE1hcFZhbHVlVHlwZTxZW0tdPlxuICAgID47XG4gIH0sXG4+ID0gWjtcblxuLyoqIE1lcmdlIGFsbCByZWNvcmRzIHR5cGVzIGRlZmluaXRpb25zIGZyb20ga2V5cyBwcmVzZW50IGluIGJvdGggb2JqZWN0cyAqL1xudHlwZSBNZXJnZUFsbFJlY29yZHM8XG4gIFQsXG4gIFUsXG4gIE9wdGlvbnMsXG4gIFggPSBQYXJ0aWFsQnlUeXBlPFQsIFJlY29yZDxQcm9wZXJ0eUtleSwgdW5rbm93bj4+LFxuICBZID0gUGFydGlhbEJ5VHlwZTxVLCBSZWNvcmQ8UHJvcGVydHlLZXksIHVua25vd24+PixcbiAgWiA9IHtcbiAgICBbSyBpbiBrZXlvZiBYICYga2V5b2YgWV06IERlZXBNZXJnZTxYW0tdLCBZW0tdLCBPcHRpb25zPjtcbiAgfSxcbj4gPSBaO1xuXG4vKiogRXhjbHVkZSBtYXAsIHNldHMgYW5kIGFycmF5IGZyb20gdHlwZSAqL1xudHlwZSBPbWl0Q29tcGxleGVzPFQ+ID0gT21pdDxcbiAgVCxcbiAga2V5b2YgUGFydGlhbEJ5VHlwZTxcbiAgICBULFxuICAgIHwgTWFwPHVua25vd24sIHVua25vd24+XG4gICAgfCBTZXQ8dW5rbm93bj5cbiAgICB8IEFycmF5PHVua25vd24+XG4gICAgfCBSZWNvcmQ8UHJvcGVydHlLZXksIHVua25vd24+XG4gID5cbj47XG5cbi8qKiBPYmplY3Qgd2l0aCBrZXlzIGluIGVpdGhlciBUIG9yIFUgYnV0IG5vdCBpbiBib3RoICovXG50eXBlIE9iamVjdFhvcktleXM8XG4gIFQsXG4gIFUsXG4gIFggPSBPbWl0PFQsIGtleW9mIFU+ICYgT21pdDxVLCBrZXlvZiBUPixcbiAgWSA9IHsgW0sgaW4ga2V5b2YgWF06IFhbS10gfSxcbj4gPSBZO1xuXG4vKiogTWVyZ2UgdHdvIG9iamVjdHMsIHdpdGggbGVmdCBwcmVjZWRlbmNlICovXG50eXBlIE1lcmdlUmlnaHRPbWl0Q29tcGxleGVzPFxuICBULFxuICBVLFxuICBYID0gT2JqZWN0WG9yS2V5czxULCBVPiAmIE9taXRDb21wbGV4ZXM8eyBbSyBpbiBrZXlvZiBVXTogVVtLXSB9Pixcbj4gPSBYO1xuXG4vKiogTWVyZ2UgdHdvIG9iamVjdHMgKi9cbnR5cGUgTWVyZ2U8XG4gIFQsXG4gIFUsXG4gIE9wdGlvbnMsXG4gIFggPVxuICAgICYgTWVyZ2VSaWdodE9taXRDb21wbGV4ZXM8VCwgVT5cbiAgICAmIE1lcmdlQWxsUmVjb3JkczxULCBVLCBPcHRpb25zPlxuICAgICYgKE9wdGlvbnMgZXh0ZW5kcyB7IHNldHM6IFwicmVwbGFjZVwiIH0gPyBQYXJ0aWFsQnlUeXBlPFUsIFNldDx1bmtub3duPj5cbiAgICAgIDogTWVyZ2VBbGxTZXRzPFQsIFU+KVxuICAgICYgKE9wdGlvbnMgZXh0ZW5kcyB7IGFycmF5czogXCJyZXBsYWNlXCIgfSA/IFBhcnRpYWxCeVR5cGU8VSwgQXJyYXk8dW5rbm93bj4+XG4gICAgICA6IE1lcmdlQWxsQXJyYXlzPFQsIFU+KVxuICAgICYgKE9wdGlvbnMgZXh0ZW5kcyB7IG1hcHM6IFwicmVwbGFjZVwiIH1cbiAgICAgID8gUGFydGlhbEJ5VHlwZTxVLCBNYXA8dW5rbm93biwgdW5rbm93bj4+XG4gICAgICA6IE1lcmdlQWxsTWFwczxULCBVPiksXG4+ID0gRXhwYW5kUmVjdXJzaXZlbHk8WD47XG5cbi8qKiBNZXJnZSBkZWVwbHkgdHdvIG9iamVjdHMgKi9cbmV4cG9ydCB0eXBlIERlZXBNZXJnZTxcbiAgVCxcbiAgVSxcbiAgT3B0aW9ucyA9IFJlY29yZDxzdHJpbmcsIE1lcmdpbmdTdHJhdGVneT4sXG4+ID1cbiAgLy8gSGFuZGxlIG9iamVjdHNcbiAgW1QsIFVdIGV4dGVuZHMgW1JlY29yZDxQcm9wZXJ0eUtleSwgdW5rbm93bj4sIFJlY29yZDxQcm9wZXJ0eUtleSwgdW5rbm93bj5dXG4gICAgPyBNZXJnZTxULCBVLCBPcHRpb25zPlxuICAgIC8vIEhhbmRsZSBwcmltaXRpdmVzXG4gICAgOiBUIHwgVTtcbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSwwRUFBMEU7QUFDMUUscUNBQXFDO0FBRXJDLGtDQUFrQztBQUVsQyxTQUFTLGFBQWEsUUFBUSxhQUFhLENBQUM7QUFFNUMsTUFBTSxFQUFFLE1BQU0sQ0FBQSxFQUFFLEdBQUcsTUFBTSxBQUFDO0FBdUMxQixPQUFPLFNBQVMsU0FBUyxDQVN2QixNQUFtQixFQUNuQixLQUFrQixFQUNsQixPQUEyQixFQUNEO0lBQzFCLE9BQU8saUJBQWlCLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxJQUFJLEdBQUcsRUFBRSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0FBQzlELENBQUM7QUFFRCxTQUFTLGlCQUFpQixDQVN4QixNQUFtQixFQUNuQixLQUFrQixFQUNsQixJQUE4QixFQUM5QixPQUEyQixFQUMzQjtJQUlBLE1BQU0sTUFBTSxHQUFvQixFQUFFLEFBQUM7SUFFbkMsTUFBTSxJQUFJLEdBQUcsSUFBSSxHQUFHLENBQUM7V0FDaEIsT0FBTyxDQUFDLE1BQU0sQ0FBQztXQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUM7S0FDbEIsQ0FBQyxBQUFxQixBQUFDO0lBRXhCLDRFQUE0RTtJQUM1RSxLQUFLLE1BQU0sR0FBRyxJQUFJLElBQUksQ0FBRTtRQUN0QiwyRkFBMkY7UUFDM0YsSUFBSSxHQUFHLEtBQUssV0FBVyxFQUFFO1lBQ3ZCLFNBQVM7UUFDWCxDQUFDO1FBSUQsTUFBTSxDQUFDLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxBQUFnQixBQUFDO1FBRXRDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxFQUFFO1lBQ3ZCLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFaEIsU0FBUztRQUNYLENBQUM7UUFFRCxNQUFNLENBQUMsR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLEFBQWdCLEFBQUM7UUFFckMsSUFDRSxlQUFlLENBQUMsQ0FBQyxDQUFDLElBQUksZUFBZSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQ3hFO1lBQ0EsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNaLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDWixNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsWUFBWSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLE9BQU8sQ0FBQyxBQUFnQixDQUFDO1lBRWhFLFNBQVM7UUFDWCxDQUFDO1FBRUQsaUJBQWlCO1FBQ2pCLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDbEIsQ0FBQztJQUVELE9BQU8sTUFBTSxDQUFXO0FBQzFCLENBQUM7QUFFRCxTQUFTLFlBQVksQ0FDbkIsSUFBbUMsRUFDbkMsS0FBb0MsRUFDcEMsSUFBOEIsRUFDOUIsT0FBbUMsR0FBRztJQUNwQyxNQUFNLEVBQUUsT0FBTztJQUNmLElBQUksRUFBRSxPQUFPO0lBQ2IsSUFBSSxFQUFFLE9BQU87Q0FDZCxFQUM4QjtJQUMvQixzQ0FBc0M7SUFDdEMsSUFBSSxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksV0FBVyxDQUFDLEtBQUssQ0FBQyxFQUFFO1FBQzNDLE9BQU8saUJBQWlCLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDdkQsQ0FBQztJQUVELElBQUksVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLFVBQVUsQ0FBQyxLQUFLLENBQUMsRUFBRTtRQUN6QyxnQkFBZ0I7UUFDaEIsSUFBSSxBQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQU0sS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQUFBQyxFQUFFO1lBQ25ELElBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxPQUFPLEVBQUU7Z0JBQzlCLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM1QixDQUFDO1lBRUQsT0FBTyxLQUFLLENBQUM7UUFDZixDQUFDO1FBRUQsY0FBYztRQUNkLElBQUksQUFBQyxJQUFJLFlBQVksR0FBRyxJQUFNLEtBQUssWUFBWSxHQUFHLEFBQUMsRUFBRTtZQUNuRCxJQUFJLE9BQU8sQ0FBQyxJQUFJLEtBQUssT0FBTyxFQUFFO2dCQUM1QixPQUFPLElBQUksR0FBRyxDQUFDO3VCQUNWLElBQUk7dUJBQ0osS0FBSztpQkFDVCxDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQsT0FBTyxLQUFLLENBQUM7UUFDZixDQUFDO1FBRUQsY0FBYztRQUNkLElBQUksQUFBQyxJQUFJLFlBQVksR0FBRyxJQUFNLEtBQUssWUFBWSxHQUFHLEFBQUMsRUFBRTtZQUNuRCxJQUFJLE9BQU8sQ0FBQyxJQUFJLEtBQUssT0FBTyxFQUFFO2dCQUM1QixPQUFPLElBQUksR0FBRyxDQUFDO3VCQUNWLElBQUk7dUJBQ0osS0FBSztpQkFDVCxDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQsT0FBTyxLQUFLLENBQUM7UUFDZixDQUFDO0lBQ0gsQ0FBQztJQUVELE9BQU8sS0FBSyxDQUFDO0FBQ2YsQ0FBQztBQUVEOzs7O0NBSUMsR0FDRCxTQUFTLFdBQVcsQ0FDbEIsS0FBMEIsRUFDYTtJQUN2QyxPQUFPLE1BQU0sQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLEtBQUssTUFBTSxDQUFDLFNBQVMsQ0FBQztBQUMzRCxDQUFDO0FBRUQsU0FBUyxVQUFVLENBQ2pCLEtBQTBCLEVBQ0U7SUFDNUIsT0FBTyxPQUFPLEFBQUMsS0FBSyxBQUFzQixDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBSyxVQUFVLENBQUM7QUFDN0UsQ0FBQztBQUVELFNBQVMsZUFBZSxDQUFDLEtBQWMsRUFBZ0M7SUFDckUsT0FBTyxLQUFLLEtBQUssSUFBSSxJQUFJLE9BQU8sS0FBSyxLQUFLLFFBQVEsQ0FBQztBQUNyRCxDQUFDO0FBRUQsU0FBUyxPQUFPLENBQW1CLE1BQVMsRUFBa0I7SUFDNUQsTUFBTSxHQUFHLEdBQUcsTUFBTSxDQUFDLHFCQUFxQixDQUFDLE1BQU0sQ0FBQyxBQUFrQixBQUFDO0lBQ25FLGFBQWEsQ0FDWCxHQUFHLEVBQ0gsQ0FBQyxHQUFHLEdBQUssTUFBTSxDQUFDLFNBQVMsQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUNqRSxDQUFDO0lBQ0YsR0FBRyxDQUFDLElBQUksSUFBSyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFvQixDQUFDO0lBRXJELE9BQU8sR0FBRyxDQUFDO0FBQ2IsQ0FBQyJ9