/*!
 * Adapted directly from https://github.com/brianc/node-buffer-writer
 * which is licensed as follows:
 *
 * The MIT License (MIT)
 *
 *
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * 'Software'), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
 * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
 * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
 * TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
 * SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */ import { copy } from "../deps.ts";
import { readInt16BE, readInt32BE } from "../utils/utils.ts";
export class PacketReader {
    #buffer;
    #decoder = new TextDecoder();
    #offset = 0;
    constructor(buffer){
        this.#buffer = buffer;
    }
    readInt16() {
        const value = readInt16BE(this.#buffer, this.#offset);
        this.#offset += 2;
        return value;
    }
    readInt32() {
        const value = readInt32BE(this.#buffer, this.#offset);
        this.#offset += 4;
        return value;
    }
    readByte() {
        return this.readBytes(1)[0];
    }
    readBytes(length) {
        const start = this.#offset;
        const end = start + length;
        const slice = this.#buffer.slice(start, end);
        this.#offset = end;
        return slice;
    }
    readAllBytes() {
        const slice = this.#buffer.slice(this.#offset);
        this.#offset = this.#buffer.length;
        return slice;
    }
    readString(length) {
        const bytes = this.readBytes(length);
        return this.#decoder.decode(bytes);
    }
    readCString() {
        const start = this.#offset;
        // find next null byte
        const end = this.#buffer.indexOf(0, start);
        const slice = this.#buffer.slice(start, end);
        // add +1 for null byte
        this.#offset = end + 1;
        return this.#decoder.decode(slice);
    }
}
export class PacketWriter {
    #buffer;
    #encoder = new TextEncoder();
    #headerPosition;
    #offset;
    #size;
    constructor(size){
        this.#size = size || 1024;
        this.#buffer = new Uint8Array(this.#size + 5);
        this.#offset = 5;
        this.#headerPosition = 0;
    }
    #ensure(size) {
        const remaining = this.#buffer.length - this.#offset;
        if (remaining < size) {
            const oldBuffer = this.#buffer;
            // exponential growth factor of around ~ 1.5
            // https://stackoverflow.com/questions/2269063/#buffer-growth-strategy
            const newSize = oldBuffer.length + (oldBuffer.length >> 1) + size;
            this.#buffer = new Uint8Array(newSize);
            copy(oldBuffer, this.#buffer);
        }
    }
    addInt32(num) {
        this.#ensure(4);
        this.#buffer[this.#offset++] = num >>> 24 & 0xff;
        this.#buffer[this.#offset++] = num >>> 16 & 0xff;
        this.#buffer[this.#offset++] = num >>> 8 & 0xff;
        this.#buffer[this.#offset++] = num >>> 0 & 0xff;
        return this;
    }
    addInt16(num) {
        this.#ensure(2);
        this.#buffer[this.#offset++] = num >>> 8 & 0xff;
        this.#buffer[this.#offset++] = num >>> 0 & 0xff;
        return this;
    }
    addCString(string) {
        // just write a 0 for empty or null strings
        if (!string) {
            this.#ensure(1);
        } else {
            const encodedStr = this.#encoder.encode(string);
            this.#ensure(encodedStr.byteLength + 1); // +1 for null terminator
            copy(encodedStr, this.#buffer, this.#offset);
            this.#offset += encodedStr.byteLength;
        }
        this.#buffer[this.#offset++] = 0; // null terminator
        return this;
    }
    addChar(c) {
        if (c.length != 1) {
            throw new Error("addChar requires single character strings");
        }
        this.#ensure(1);
        copy(this.#encoder.encode(c), this.#buffer, this.#offset);
        this.#offset++;
        return this;
    }
    addString(string) {
        string = string || "";
        const encodedStr = this.#encoder.encode(string);
        this.#ensure(encodedStr.byteLength);
        copy(encodedStr, this.#buffer, this.#offset);
        this.#offset += encodedStr.byteLength;
        return this;
    }
    add(otherBuffer) {
        this.#ensure(otherBuffer.length);
        copy(otherBuffer, this.#buffer, this.#offset);
        this.#offset += otherBuffer.length;
        return this;
    }
    clear() {
        this.#offset = 5;
        this.#headerPosition = 0;
    }
    // appends a header block to all the written data since the last
    // subsequent header or to the beginning if there is only one data block
    addHeader(code, last) {
        const origOffset = this.#offset;
        this.#offset = this.#headerPosition;
        this.#buffer[this.#offset++] = code;
        // length is everything in this packet minus the code
        this.addInt32(origOffset - (this.#headerPosition + 1));
        // set next header position
        this.#headerPosition = origOffset;
        // make space for next header
        this.#offset = origOffset;
        if (!last) {
            this.#ensure(5);
            this.#offset += 5;
        }
        return this;
    }
    join(code) {
        if (code) {
            this.addHeader(code, true);
        }
        return this.#buffer.slice(code ? 0 : 5, this.#offset);
    }
    flush(code) {
        const result = this.join(code);
        this.clear();
        return result;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gvcG9zdGdyZXNAdjAuMTcuMC9jb25uZWN0aW9uL3BhY2tldC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqIEFkYXB0ZWQgZGlyZWN0bHkgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vYnJpYW5jL25vZGUtYnVmZmVyLXdyaXRlclxuICogd2hpY2ggaXMgbGljZW5zZWQgYXMgZm9sbG93czpcbiAqXG4gKiBUaGUgTUlUIExpY2Vuc2UgKE1JVClcbiAqXG4gKlxuICogUGVybWlzc2lvbiBpcyBoZXJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueSBwZXJzb24gb2J0YWluaW5nXG4gKiBhIGNvcHkgb2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGVcbiAqICdTb2Z0d2FyZScpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmdcbiAqIHdpdGhvdXQgbGltaXRhdGlvbiB0aGUgcmlnaHRzIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBtZXJnZSwgcHVibGlzaCxcbiAqIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsIGNvcGllcyBvZiB0aGUgU29mdHdhcmUsIGFuZCB0b1xuICogcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvXG4gKiB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnM6XG4gKlxuICogVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW5kIHRoaXMgcGVybWlzc2lvbiBub3RpY2Ugc2hhbGwgYmVcbiAqIGluY2x1ZGVkIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLlxuICpcbiAqIFRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAnQVMgSVMnLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELFxuICogRVhQUkVTUyBPUiBJTVBMSUVELCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEIFRPIFRIRSBXQVJSQU5USUVTIE9GXG4gKiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuXG4gKiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWVxuICogQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSVRZLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCxcbiAqIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFXG4gKiBTT0ZUV0FSRSBPUiBUSEUgVVNFIE9SIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS5cbiAqL1xuXG5pbXBvcnQgeyBjb3B5IH0gZnJvbSBcIi4uL2RlcHMudHNcIjtcbmltcG9ydCB7IHJlYWRJbnQxNkJFLCByZWFkSW50MzJCRSB9IGZyb20gXCIuLi91dGlscy91dGlscy50c1wiO1xuXG5leHBvcnQgY2xhc3MgUGFja2V0UmVhZGVyIHtcbiAgI2J1ZmZlcjogVWludDhBcnJheTtcbiAgI2RlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoKTtcbiAgI29mZnNldCA9IDA7XG5cbiAgY29uc3RydWN0b3IoYnVmZmVyOiBVaW50OEFycmF5KSB7XG4gICAgdGhpcy4jYnVmZmVyID0gYnVmZmVyO1xuICB9XG5cbiAgcmVhZEludDE2KCk6IG51bWJlciB7XG4gICAgY29uc3QgdmFsdWUgPSByZWFkSW50MTZCRSh0aGlzLiNidWZmZXIsIHRoaXMuI29mZnNldCk7XG4gICAgdGhpcy4jb2Zmc2V0ICs9IDI7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgcmVhZEludDMyKCk6IG51bWJlciB7XG4gICAgY29uc3QgdmFsdWUgPSByZWFkSW50MzJCRSh0aGlzLiNidWZmZXIsIHRoaXMuI29mZnNldCk7XG4gICAgdGhpcy4jb2Zmc2V0ICs9IDQ7XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgcmVhZEJ5dGUoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5yZWFkQnl0ZXMoMSlbMF07XG4gIH1cblxuICByZWFkQnl0ZXMobGVuZ3RoOiBudW1iZXIpOiBVaW50OEFycmF5IHtcbiAgICBjb25zdCBzdGFydCA9IHRoaXMuI29mZnNldDtcbiAgICBjb25zdCBlbmQgPSBzdGFydCArIGxlbmd0aDtcbiAgICBjb25zdCBzbGljZSA9IHRoaXMuI2J1ZmZlci5zbGljZShzdGFydCwgZW5kKTtcbiAgICB0aGlzLiNvZmZzZXQgPSBlbmQ7XG4gICAgcmV0dXJuIHNsaWNlO1xuICB9XG5cbiAgcmVhZEFsbEJ5dGVzKCk6IFVpbnQ4QXJyYXkge1xuICAgIGNvbnN0IHNsaWNlID0gdGhpcy4jYnVmZmVyLnNsaWNlKHRoaXMuI29mZnNldCk7XG4gICAgdGhpcy4jb2Zmc2V0ID0gdGhpcy4jYnVmZmVyLmxlbmd0aDtcbiAgICByZXR1cm4gc2xpY2U7XG4gIH1cblxuICByZWFkU3RyaW5nKGxlbmd0aDogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBjb25zdCBieXRlcyA9IHRoaXMucmVhZEJ5dGVzKGxlbmd0aCk7XG4gICAgcmV0dXJuIHRoaXMuI2RlY29kZXIuZGVjb2RlKGJ5dGVzKTtcbiAgfVxuXG4gIHJlYWRDU3RyaW5nKCk6IHN0cmluZyB7XG4gICAgY29uc3Qgc3RhcnQgPSB0aGlzLiNvZmZzZXQ7XG4gICAgLy8gZmluZCBuZXh0IG51bGwgYnl0ZVxuICAgIGNvbnN0IGVuZCA9IHRoaXMuI2J1ZmZlci5pbmRleE9mKDAsIHN0YXJ0KTtcbiAgICBjb25zdCBzbGljZSA9IHRoaXMuI2J1ZmZlci5zbGljZShzdGFydCwgZW5kKTtcbiAgICAvLyBhZGQgKzEgZm9yIG51bGwgYnl0ZVxuICAgIHRoaXMuI29mZnNldCA9IGVuZCArIDE7XG4gICAgcmV0dXJuIHRoaXMuI2RlY29kZXIuZGVjb2RlKHNsaWNlKTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgUGFja2V0V3JpdGVyIHtcbiAgI2J1ZmZlcjogVWludDhBcnJheTtcbiAgI2VuY29kZXIgPSBuZXcgVGV4dEVuY29kZXIoKTtcbiAgI2hlYWRlclBvc2l0aW9uOiBudW1iZXI7XG4gICNvZmZzZXQ6IG51bWJlcjtcbiAgI3NpemU6IG51bWJlcjtcblxuICBjb25zdHJ1Y3RvcihzaXplPzogbnVtYmVyKSB7XG4gICAgdGhpcy4jc2l6ZSA9IHNpemUgfHwgMTAyNDtcbiAgICB0aGlzLiNidWZmZXIgPSBuZXcgVWludDhBcnJheSh0aGlzLiNzaXplICsgNSk7XG4gICAgdGhpcy4jb2Zmc2V0ID0gNTtcbiAgICB0aGlzLiNoZWFkZXJQb3NpdGlvbiA9IDA7XG4gIH1cblxuICAjZW5zdXJlKHNpemU6IG51bWJlcikge1xuICAgIGNvbnN0IHJlbWFpbmluZyA9IHRoaXMuI2J1ZmZlci5sZW5ndGggLSB0aGlzLiNvZmZzZXQ7XG4gICAgaWYgKHJlbWFpbmluZyA8IHNpemUpIHtcbiAgICAgIGNvbnN0IG9sZEJ1ZmZlciA9IHRoaXMuI2J1ZmZlcjtcbiAgICAgIC8vIGV4cG9uZW50aWFsIGdyb3d0aCBmYWN0b3Igb2YgYXJvdW5kIH4gMS41XG4gICAgICAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8yMjY5MDYzLyNidWZmZXItZ3Jvd3RoLXN0cmF0ZWd5XG4gICAgICBjb25zdCBuZXdTaXplID0gb2xkQnVmZmVyLmxlbmd0aCArIChvbGRCdWZmZXIubGVuZ3RoID4+IDEpICsgc2l6ZTtcbiAgICAgIHRoaXMuI2J1ZmZlciA9IG5ldyBVaW50OEFycmF5KG5ld1NpemUpO1xuICAgICAgY29weShvbGRCdWZmZXIsIHRoaXMuI2J1ZmZlcik7XG4gICAgfVxuICB9XG5cbiAgYWRkSW50MzIobnVtOiBudW1iZXIpIHtcbiAgICB0aGlzLiNlbnN1cmUoNCk7XG4gICAgdGhpcy4jYnVmZmVyW3RoaXMuI29mZnNldCsrXSA9IChudW0gPj4+IDI0KSAmIDB4ZmY7XG4gICAgdGhpcy4jYnVmZmVyW3RoaXMuI29mZnNldCsrXSA9IChudW0gPj4+IDE2KSAmIDB4ZmY7XG4gICAgdGhpcy4jYnVmZmVyW3RoaXMuI29mZnNldCsrXSA9IChudW0gPj4+IDgpICYgMHhmZjtcbiAgICB0aGlzLiNidWZmZXJbdGhpcy4jb2Zmc2V0KytdID0gKG51bSA+Pj4gMCkgJiAweGZmO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYWRkSW50MTYobnVtOiBudW1iZXIpIHtcbiAgICB0aGlzLiNlbnN1cmUoMik7XG4gICAgdGhpcy4jYnVmZmVyW3RoaXMuI29mZnNldCsrXSA9IChudW0gPj4+IDgpICYgMHhmZjtcbiAgICB0aGlzLiNidWZmZXJbdGhpcy4jb2Zmc2V0KytdID0gKG51bSA+Pj4gMCkgJiAweGZmO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYWRkQ1N0cmluZyhzdHJpbmc/OiBzdHJpbmcpIHtcbiAgICAvLyBqdXN0IHdyaXRlIGEgMCBmb3IgZW1wdHkgb3IgbnVsbCBzdHJpbmdzXG4gICAgaWYgKCFzdHJpbmcpIHtcbiAgICAgIHRoaXMuI2Vuc3VyZSgxKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgZW5jb2RlZFN0ciA9IHRoaXMuI2VuY29kZXIuZW5jb2RlKHN0cmluZyk7XG4gICAgICB0aGlzLiNlbnN1cmUoZW5jb2RlZFN0ci5ieXRlTGVuZ3RoICsgMSk7IC8vICsxIGZvciBudWxsIHRlcm1pbmF0b3JcbiAgICAgIGNvcHkoZW5jb2RlZFN0ciwgdGhpcy4jYnVmZmVyLCB0aGlzLiNvZmZzZXQpO1xuICAgICAgdGhpcy4jb2Zmc2V0ICs9IGVuY29kZWRTdHIuYnl0ZUxlbmd0aDtcbiAgICB9XG5cbiAgICB0aGlzLiNidWZmZXJbdGhpcy4jb2Zmc2V0KytdID0gMDsgLy8gbnVsbCB0ZXJtaW5hdG9yXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBhZGRDaGFyKGM6IHN0cmluZykge1xuICAgIGlmIChjLmxlbmd0aCAhPSAxKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJhZGRDaGFyIHJlcXVpcmVzIHNpbmdsZSBjaGFyYWN0ZXIgc3RyaW5nc1wiKTtcbiAgICB9XG5cbiAgICB0aGlzLiNlbnN1cmUoMSk7XG4gICAgY29weSh0aGlzLiNlbmNvZGVyLmVuY29kZShjKSwgdGhpcy4jYnVmZmVyLCB0aGlzLiNvZmZzZXQpO1xuICAgIHRoaXMuI29mZnNldCsrO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYWRkU3RyaW5nKHN0cmluZz86IHN0cmluZykge1xuICAgIHN0cmluZyA9IHN0cmluZyB8fCBcIlwiO1xuICAgIGNvbnN0IGVuY29kZWRTdHIgPSB0aGlzLiNlbmNvZGVyLmVuY29kZShzdHJpbmcpO1xuICAgIHRoaXMuI2Vuc3VyZShlbmNvZGVkU3RyLmJ5dGVMZW5ndGgpO1xuICAgIGNvcHkoZW5jb2RlZFN0ciwgdGhpcy4jYnVmZmVyLCB0aGlzLiNvZmZzZXQpO1xuICAgIHRoaXMuI29mZnNldCArPSBlbmNvZGVkU3RyLmJ5dGVMZW5ndGg7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBhZGQob3RoZXJCdWZmZXI6IFVpbnQ4QXJyYXkpIHtcbiAgICB0aGlzLiNlbnN1cmUob3RoZXJCdWZmZXIubGVuZ3RoKTtcbiAgICBjb3B5KG90aGVyQnVmZmVyLCB0aGlzLiNidWZmZXIsIHRoaXMuI29mZnNldCk7XG4gICAgdGhpcy4jb2Zmc2V0ICs9IG90aGVyQnVmZmVyLmxlbmd0aDtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGNsZWFyKCkge1xuICAgIHRoaXMuI29mZnNldCA9IDU7XG4gICAgdGhpcy4jaGVhZGVyUG9zaXRpb24gPSAwO1xuICB9XG5cbiAgLy8gYXBwZW5kcyBhIGhlYWRlciBibG9jayB0byBhbGwgdGhlIHdyaXR0ZW4gZGF0YSBzaW5jZSB0aGUgbGFzdFxuICAvLyBzdWJzZXF1ZW50IGhlYWRlciBvciB0byB0aGUgYmVnaW5uaW5nIGlmIHRoZXJlIGlzIG9ubHkgb25lIGRhdGEgYmxvY2tcbiAgYWRkSGVhZGVyKGNvZGU6IG51bWJlciwgbGFzdD86IGJvb2xlYW4pIHtcbiAgICBjb25zdCBvcmlnT2Zmc2V0ID0gdGhpcy4jb2Zmc2V0O1xuICAgIHRoaXMuI29mZnNldCA9IHRoaXMuI2hlYWRlclBvc2l0aW9uO1xuICAgIHRoaXMuI2J1ZmZlclt0aGlzLiNvZmZzZXQrK10gPSBjb2RlO1xuICAgIC8vIGxlbmd0aCBpcyBldmVyeXRoaW5nIGluIHRoaXMgcGFja2V0IG1pbnVzIHRoZSBjb2RlXG4gICAgdGhpcy5hZGRJbnQzMihvcmlnT2Zmc2V0IC0gKHRoaXMuI2hlYWRlclBvc2l0aW9uICsgMSkpO1xuICAgIC8vIHNldCBuZXh0IGhlYWRlciBwb3NpdGlvblxuICAgIHRoaXMuI2hlYWRlclBvc2l0aW9uID0gb3JpZ09mZnNldDtcbiAgICAvLyBtYWtlIHNwYWNlIGZvciBuZXh0IGhlYWRlclxuICAgIHRoaXMuI29mZnNldCA9IG9yaWdPZmZzZXQ7XG4gICAgaWYgKCFsYXN0KSB7XG4gICAgICB0aGlzLiNlbnN1cmUoNSk7XG4gICAgICB0aGlzLiNvZmZzZXQgKz0gNTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBqb2luKGNvZGU/OiBudW1iZXIpIHtcbiAgICBpZiAoY29kZSkge1xuICAgICAgdGhpcy5hZGRIZWFkZXIoY29kZSwgdHJ1ZSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLiNidWZmZXIuc2xpY2UoY29kZSA/IDAgOiA1LCB0aGlzLiNvZmZzZXQpO1xuICB9XG5cbiAgZmx1c2goY29kZT86IG51bWJlcikge1xuICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuam9pbihjb2RlKTtcbiAgICB0aGlzLmNsZWFyKCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxufVxuIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0NBeUJDLEdBRUQsU0FB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